<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aadhar Verification Form</title>
    <!-- Include SweetAlert CSS and JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    {% include 'animation.html' %}
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            width: 400px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        input[type="text"], select {
            width: calc(33% - 10px);
            padding: 10px;
            margin: 5px 5px 15px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .last-4 {
            width: 100%;
            padding: 10px;
            margin: 5px 0 15px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="submit"] {
            width: 100%;
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        input[type="submit"]:hover {
            background-color: #45a049;
        }
        label {
            font-size: 16px;
        }
        .error {
            color: red;
            font-size: 14px;
            display: none;
        }
        .container {
        flex-direction: column;
        align-items: center;
}

    </style>
</head>
<body>
    
<div class="container">
    <h2>Verification / Personal Details</h2>
    <p><strong>Other Verification</strong><br>Please fill the following details as per Aadhar Card for authentication purposes.</p>
    
    <form id="aadharForm" method="POST" onsubmit="return validateForm()">
        {% csrf_token %}
        <label for="aadhar">Aadhar Number (last 4 digits) *</label><br>
        XXXX - XXXX - 
        <input type="text" id="aadhar3" name="aadhar" class="last-4" maxlength="4" required>
        <div class="error" id="aadharError">Please enter exactly 4 digits.</div>
        <br><br>
        
        <label for="name">Name *</label><br>
        <input type="text" id="firstName" name="firstName" placeholder="First" required>
        <div class="error" id="firstNameError">First name should be at least 4 letters and contain no numbers.</div>
        
        <input type="text" id="middleName" name="middleName" placeholder="Middle">
        
        <input type="text" id="lastName" name="lastName" placeholder="Surname" required>
        <div class="error" id="lastNameError">Last name should be at least 4 letters and contain no numbers.</div>
        <br><br>
        
        <label for="dob">Date of Birth *</label><br>
        <select id="day" name="day" required>
            <option value="">Day</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
            <option value="16">16</option>
            <option value="17">17</option>
            <option value="18">18</option>
            <option value="19">19</option>
            <option value="20">20</option>
            <option value="21">21</option>
            <option value="22">22</option>
            <option value="23">23</option>
            <option value="24">24</option>
            <option value="25">25</option>
            <option value="26">26</option>
            <option value="27">27</option>
            <option value="28">28</option>
            <option value="29">29</option>
            <option value="30">30</option>
            <option value="31">31</option>
        
        </select>
        
        <select id="month" name="month" required>
            <option value="">Month</option>
            <option value="January">January</option>
            <option value="February">February</option>
            <option value="March">March</option>
            <option value="April">April</option>
            <option value="May">May</option>
            <option value="June">June</option>
            <option value="July">July</option>
            <option value="August">August</option>
            <option value="September">September</option>
            <option value="October">October</option>
            <option value="November">November</option>
            <option value="December">December</option>
        </select>
        </select>
        
        <select id="year" name="year" required>
            <option value="">Year</option>
            <option value="2024">2024</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
            <option value="2021">2021</option>
            <option value="2020">2020</option>
            <option value="2019">2019</option>
            <option value="2018">2018</option>
            <option value="2017">2017</option>
            <option value="2016">2016</option>
            <option value="2015">2015</option>
            <option value="2014">2014</option>
            <option value="2013">2013</option>
            <option value="2012">2012</option>
            <option value="2011">2011</option>
            <option value="2010">2010</option>
            <option value="2009">2009</option>
            <option value="2008">2008</option>
            <option value="2007">2007</option>
            <option value="2006">2006</option>
            <option value="2005">2005</option>
            <option value="2004">2004</option>
            <option value="2003">2003</option>
            <option value="2002">2002</option>
            <option value="2001">2001</option>
            <option value="2000">2000</option>
            <option value="1999">1999</option>
            <option value="1998">1998</option>
            <option value="1997">1997</option>
            <option value="1996">1996</option>
            <option value="1995">1995</option>
            <option value="1994">1994</option>
            <option value="1993">1993</option>
            <option value="1992">1992</option>
            <option value="1991">1991</option>
            <option value="1990">1990</option>
            <option value="1989">1989</option>
            <option value="1988">1988</option>
            <option value="1987">1987</option>
            <option value="1986">1986</option>
            <option value="1985">1985</option>
            <option value="1984">1984</option>

        </select>
        <br><br>
        
        <input type="submit" value="Proceed">
    </form>
    
</div>

<script>
    function validateForm() {
    // Clear previous errors
    document.getElementById('aadharError').style.display = 'none';
    document.getElementById('firstNameError').style.display = 'none';
    document.getElementById('lastNameError').style.display = 'none';
    
    // Get form values
    var aadhar = document.getElementById('aadhar3').value;
    var firstName = document.getElementById('firstName').value;
    var lastName = document.getElementById('lastName').value;

    var valid = true;

    // Validate Aadhar (must be 4 digits)
    if (!/^\d{4}$/.test(aadhar)) {
        document.getElementById('aadharError').style.display = 'block';
        valid = false;
    }

    // Validate First Name (at least 3 characters and no numbers)
    if (firstName.length < 3 || /\d/.test(firstName)) {
        document.getElementById('firstNameError').style.display = 'block';
        valid = false;
    }

    // Validate Last Name (at least 1 character and no numbers)
    if (lastName.length < 1 || /\d/.test(lastName)) {
        document.getElementById('lastNameError').style.display = 'block';
        valid = false;
    }

    // If the form is valid, submit using AJAX
    if (valid) {
        // Submit the form using AJAX
        var formData = new FormData(document.getElementById('aadharForm'));

        // Get CSRF token
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        fetch("{% url 'aadhar' %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrftoken
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                Swal.fire({
                    title: 'Success!',
                    text: data.message,
                    icon: 'success',
                    confirmButtonText: 'OK'
                }).then(() => {
                    // Redirect to 'personal_1' page after successful form submission
                    window.location.href = "{% url 'personal_1' %}";
                });
            } else {
                let errorMessage = data.message;
                if (data.errors) {
                    errorMessage += '<br>' + Object.values(data.errors).join('<br>');
                }
                Swal.fire({
                    title: 'Error!',
                    html: errorMessage,
                    icon: 'error',
                    confirmButtonText: 'Try Again'
                });
            }
        })
        .catch(error => {
            Swal.fire({
                title: 'Error!',
                text: 'Something went wrong during submission.',
                icon: 'error',
                confirmButtonText: 'Try Again'
            });
        });

        return false; // Prevent traditional form submission
    }

    return valid; // If form is invalid, prevent submission
}

</script>

</body>
</html>
